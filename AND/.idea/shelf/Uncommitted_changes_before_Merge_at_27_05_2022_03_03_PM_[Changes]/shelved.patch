Index: app/src/main/java/com/example/farmerama/MainActivity.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>package com.example.farmerama;\r\n\r\nimport android.app.NotificationChannel;\r\nimport android.app.NotificationManager;\r\nimport android.content.Context;\r\nimport android.content.Intent;\r\nimport android.os.Bundle;\r\nimport android.view.Menu;\r\nimport android.view.MenuItem;\r\nimport android.view.View;\r\nimport android.widget.ImageView;\r\nimport android.widget.TextView;\r\nimport android.widget.Toast;\r\n\r\nimport androidx.annotation.NonNull;\r\nimport androidx.appcompat.app.AppCompatActivity;\r\nimport androidx.appcompat.widget.Toolbar;\r\nimport androidx.core.app.NotificationManagerCompat;\r\nimport androidx.drawerlayout.widget.DrawerLayout;\r\nimport androidx.lifecycle.ViewModelProvider;\r\nimport androidx.navigation.NavController;\r\nimport androidx.navigation.Navigation;\r\nimport androidx.navigation.ui.AppBarConfiguration;\r\nimport androidx.navigation.ui.NavigationUI;\r\nimport androidx.work.PeriodicWorkRequest;\r\nimport androidx.work.WorkManager;\r\n\r\nimport android.content.SharedPreferences;\r\n\r\nimport com.example.farmerama.data.model.LogObj;\r\nimport com.example.farmerama.data.util.NotificationWorker;\r\nimport com.example.farmerama.data.util.ToastMessage;\r\nimport com.example.farmerama.viewmodel.MainActivityViewModel;\r\nimport com.google.android.material.navigation.NavigationView;\r\nimport com.google.firebase.storage.FirebaseStorage;\r\nimport com.google.firebase.storage.StorageReference;\r\nimport com.squareup.picasso.Picasso;\r\n\r\nimport java.util.concurrent.TimeUnit;\r\n\r\npublic class MainActivity extends AppCompatActivity {\r\n    private NavController navController;\r\n    private AppBarConfiguration appBarConfiguration;\r\n    private Toolbar toolbar;\r\n    private DrawerLayout drawerLayout;\r\n    private NavigationView navigationDrawer;\r\n    private MainActivityViewModel viewModel;\r\n    private String prevStarted = \"yes\";\r\n\r\n    @Override\r\n    protected void onCreate(Bundle savedInstanceState) {\r\n        super.onCreate(savedInstanceState);\r\n        setContentView(R.layout.activity_main);\r\n        initViews();\r\n        setUpViews();\r\n        setupNavigation();\r\n        setUpLoggedInUser();\r\n    }\r\n\r\n    @Override\r\n    protected void onResume() {\r\n        super.onResume();\r\n        SharedPreferences sharedpreferences = getSharedPreferences(getString(R.string.app_name), Context.MODE_PRIVATE);\r\n        if (!sharedpreferences.getBoolean(prevStarted, false)) {\r\n            SharedPreferences.Editor editor = sharedpreferences.edit();\r\n            editor.putBoolean(prevStarted, Boolean.TRUE);\r\n            editor.apply();\r\n        } else {\r\n            navController.navigate(R.id.loginFragment);\r\n        }\r\n    }\r\n\r\n    @Override\r\n    public boolean onCreateOptionsMenu(Menu menu) {\r\n        getMenuInflater().inflate(R.menu.toolbar_menu, menu);\r\n        return viewModel.isLogged();\r\n    }\r\n\r\n\r\n    private void initViews() {\r\n        drawerLayout = findViewById(R.id.drawer_layout);\r\n        navigationDrawer = findViewById(R.id.nav_view);\r\n        toolbar = findViewById(R.id.toolbar);\r\n        viewModel = new ViewModelProvider(this).get(MainActivityViewModel.class);\r\n    }\r\n\r\n    private void setUpViews() {\r\n        viewModel.retrieveBarns();\r\n        NotificationChannel channel = new NotificationChannel(\"22\", \"thresholdNotification\", NotificationManager.IMPORTANCE_DEFAULT);\r\n        channel.setDescription(\"Channel for the notification regarding exceeding thresholds\");\r\n        NotificationManager notificationManager = getSystemService(NotificationManager.class);\r\n        notificationManager.createNotificationChannel(channel);\r\n\r\n        ToastMessage.getToastMessage().observe(this, toast -> {\r\n            if (!toast.isEmpty())\r\n                Toast.makeText(this, toast, Toast.LENGTH_SHORT).show();\r\n        });\r\n\r\n        viewModel.getTodayLogs().observeForever(logObjs -> {\r\n            for (LogObj log : logObjs)\r\n                publishNotification(log);\r\n        });\r\n    }\r\n\r\n    private void setupNavigation() {\r\n        navController = Navigation.findNavController(this, R.id.fragment);\r\n        setSupportActionBar(toolbar);\r\n        appBarConfiguration = new AppBarConfiguration.Builder(\r\n                R.id.latestDataFragment,\r\n                R.id.loginFragment,\r\n                R.id.historicalDataFragment,\r\n                R.id.areasFragment,\r\n                R.id.employeesFragment,\r\n                R.id.logsFragment,\r\n                R.id.thresholdDataFragment,\r\n                R.id.thresholdModificationFragment,\r\n                R.id.registerFragment)\r\n                .setOpenableLayout(drawerLayout)\r\n                .build();\r\n\r\n        NavigationUI.setupActionBarWithNavController(this, navController, appBarConfiguration);\r\n        NavigationUI.setupWithNavController(navigationDrawer, navController);\r\n\r\n        navigationDrawer.setNavigationItemSelectedListener(item -> {\r\n            navController.navigate(item.getItemId());\r\n            drawerLayout.closeDrawers();\r\n            return true;\r\n        });\r\n\r\n        for (int i = 0; i < navigationDrawer.getMenu().size(); i++) {\r\n            navigationDrawer.getMenu().getItem(i).setVisible(false);\r\n        }\r\n        invalidateOptionsMenu();\r\n        navigationDrawer.getMenu().findItem(R.id.loginFragment).setVisible(true);\r\n        navigationDrawer.getMenu().findItem(R.id.latestDataFragment).setVisible(true);\r\n\r\n        navController.addOnDestinationChangedListener((controller, destination, arguments) -> {\r\n            int id = destination.getId();\r\n\r\n            if (id == R.id.loginFragment || id == R.id.introVPFragment) {\r\n                toolbar.setVisibility(View.GONE);\r\n                drawerLayout.setDrawerLockMode(DrawerLayout.LOCK_MODE_LOCKED_CLOSED);\r\n            } else {\r\n                toolbar.setVisibility(View.VISIBLE);\r\n                drawerLayout.setDrawerLockMode(DrawerLayout.LOCK_MODE_UNLOCKED);\r\n            }\r\n        });\r\n    }\r\n\r\n    private void setUpLoggedInUser() {\r\n        WorkRequest request = new PeriodicWorkRequest.Builder(NotificationWorker.class, 15, TimeUnit.MINUTES).build();\r\n\r\n        viewModel.getLoggedInUser().observe(this, loggedInUser -> {\r\n            if (loggedInUser != null) {\r\n                Toast.makeText(this, \"Logged in user\", Toast.LENGTH_SHORT).show();\r\n                viewModel.saveLoggedInUser(loggedInUser);\r\n\r\n                // TODO check better\r\n                if (viewModel.isGettingNotifications())\r\n                    WorkManager.getInstance(this).enqueue(request);\r\n\r\n                TextView usernameHeader = findViewById(R.id.UsernameHeader);\r\n                TextView emailHeader = findViewById(R.id.EmailHeader);\r\n                ImageView profilePicture = findViewById(R.id.imageView);\r\n                if (usernameHeader != null && emailHeader != null) {\r\n                    usernameHeader.setText(loggedInUser.getName());\r\n                    emailHeader.setText(loggedInUser.getEmail());\r\n                    StorageReference storageRef = FirebaseStorage.getInstance().getReference().child(\"users/\" + loggedInUser.getUserId() + \"/profile.jpg\");\r\n                    storageRef.getDownloadUrl().addOnSuccessListener(uri -> Picasso.get().load(uri).into(profilePicture));\r\n                }\r\n                toolbar.setVisibility(View.VISIBLE);\r\n                for (int i = 0; i < navigationDrawer.getMenu().size(); i++) {\r\n                    navigationDrawer.getMenu().getItem(i).setVisible(true);\r\n                }\r\n                if (loggedInUser.getRole().equals(\"EMPLOYEE\")) {\r\n                    navigationDrawer.getMenu().findItem(R.id.registerFragment).setVisible(false);\r\n                    navigationDrawer.getMenu().findItem(R.id.thresholdModificationFragment).setVisible(false);\r\n                }\r\n                if (loggedInUser.getRole().equals(\"OFFLINE\")) {\r\n\r\n                }\r\n                navigationDrawer.getMenu().findItem(R.id.loginFragment).setVisible(false);\r\n                navController.navigate(R.id.latestDataFragment);\r\n                viewModel.setLogged(true);\r\n            } else {\r\n                for (int i = 0; i < navigationDrawer.getMenu().size(); i++) {\r\n                    navigationDrawer.getMenu().getItem(i).setVisible(false);\r\n                }\r\n                navigationDrawer.getMenu().findItem(R.id.loginFragment).setVisible(true);\r\n                navigationDrawer.getMenu().findItem(R.id.latestDataFragment).setVisible(true);\r\n\r\n                WorkManager.getInstance(this).cancelAllWork();\r\n\r\n                viewModel.removeLoggedInUser();\r\n                navController.navigate(R.id.loginFragment);\r\n                viewModel.setLogged(false);\r\n            }\r\n\r\n            invalidateOptionsMenu();\r\n        });\r\n    }\r\n\r\n    private void publishNotification(LogObj log) {\r\n        NotificationCompat.Builder builder = new NotificationCompat.Builder(getBaseContext(), \"22\")\r\n                .setSmallIcon(R.mipmap.application_launcher)\r\n                .setContentTitle(\"Measurement out of the thresholds\")\r\n                .setContentText(String.format(\"Exceeded %s in area %s\", log.getMeasurementType(), log.getAreaName()))\r\n                .setPriority(NotificationCompat.PRIORITY_DEFAULT)\r\n                .setChannelId(\"22\");\r\n\r\n        NotificationManagerCompat notificationManager = NotificationManagerCompat.from(getBaseContext());\r\n        notificationManager.notify(22, builder.build());\r\n    }\r\n\r\n    @Override\r\n    public boolean onSupportNavigateUp() {\r\n        return NavigationUI.navigateUp(navController, appBarConfiguration) || super.onSupportNavigateUp();\r\n    }\r\n\r\n    @Override\r\n    public boolean onOptionsItemSelected(@NonNull MenuItem item) {\r\n        if (item.getItemId() == R.id.signOut) {\r\n            viewModel.logOut();\r\n            return true;\r\n        }\r\n\r\n        if (item.getItemId() == R.id.settings) {\r\n            startActivity(new Intent(this, SettingsActivity.class));\r\n            return true;\r\n        }\r\n\r\n        if (item.getItemId() == R.id.accountFragment) {\r\n            navController.navigate(item.getItemId());\r\n            return true;\r\n        }\r\n\r\n        return NavigationUI.navigateUp(navController, appBarConfiguration) || super.onSupportNavigateUp();\r\n    }\r\n}
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/app/src/main/java/com/example/farmerama/MainActivity.java b/app/src/main/java/com/example/farmerama/MainActivity.java
--- a/app/src/main/java/com/example/farmerama/MainActivity.java	(revision fe74b6d075b76dbcad2e6ca941ce709b5838a47b)
+++ b/app/src/main/java/com/example/farmerama/MainActivity.java	(date 1653656593240)
@@ -15,6 +15,7 @@
 import androidx.annotation.NonNull;
 import androidx.appcompat.app.AppCompatActivity;
 import androidx.appcompat.widget.Toolbar;
+import androidx.core.app.NotificationCompat;
 import androidx.core.app.NotificationManagerCompat;
 import androidx.drawerlayout.widget.DrawerLayout;
 import androidx.lifecycle.ViewModelProvider;
@@ -24,6 +25,7 @@
 import androidx.navigation.ui.NavigationUI;
 import androidx.work.PeriodicWorkRequest;
 import androidx.work.WorkManager;
+import androidx.work.WorkRequest;
 
 import android.content.SharedPreferences;
 
